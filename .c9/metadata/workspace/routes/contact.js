{"filter":false,"title":"contact.js","tooltip":"/routes/contact.js","undoManager":{"mark":4,"position":4,"stack":[[{"start":{"row":0,"column":0},"end":{"row":59,"column":24},"action":"insert","lines":["var router = express.Router();","var nodemailer = require(\"nodemailer\");","var request = require(\"request\");","","// contact form","router.get(\"/\", function(req, res) {","   res.render(\"contact/contactMe\", {page: 'contact'});","});","","router.post(\"/send\", function(req, res) {","    const captcha = req.body[\"g-recaptcha-response\"];","    if (!captcha) {","      console.log(req.body);","      req.flash(\"error\", \"Please select captcha\");","      return res.redirect(\"back\");","    }","    // secret key","    var secretKey = process.env.CAPTCHA;","    // Verify URL","    var verifyURL = `https://www.google.com/recaptcha/api/siteverify?secret=${secretKey}&response=${captcha}&remoteip=${req","      .connection.remoteAddress}`;","    // Make request to Verify URL","    request.get(verifyURL, (err, response, body) => {","      // if not successful","      if (body.success !== undefined && !body.success) {","        req.flash(\"error\", \"Captcha Failed\");","        return res.redirect(\"/contact\");","      }","        var smtpTransport = nodemailer.createTransport({","            service: 'Gmail', ","            auth: {","              user: 'your@gmail.com',","              pass: process.env.GMAILPW1","            }","        });","         ","        var mailOptions = {","            from: 'Your Name <your@gmail.com',","            to: 'your@gmail.com',","            replyTo: req.body.email,","            subject: \"Let's Camp contact request from: \" + req.body.name,","            text: 'You have received an email from... Name: '+ req.body.name + ' Phone: ' + req.body.phone + ' Email: ' + req.body.email + ' Message: ' + req.body.message,","            html: '<h3>You have received an email from...</h3><ul><li>Name: ' + req.body.name + ' </li><li>Phone: ' + req.body.phone + ' </li><li>Email: ' + req.body.email + ' </li></ul><p>Message: <br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + req.body.message + ' </p>'","        };","        ","        smtpTransport.sendMail(mailOptions, function(err, info){","          if(err) {","            console.log(err)","            req.flash(\"error\", \"Something went wrong... Please try again later!\");","            res.redirect(\"/contact\");","          } else {","            req.flash(\"success\", \"Your email has been sent, we will respond within 24 hours.\");","            res.redirect(\"/campgrounds\");","            ","          }","        });","    });","});","","module.exports = router;"],"id":1}],[{"start":{"row":31,"column":21},"end":{"row":31,"column":35},"action":"remove","lines":["your@gmail.com"],"id":2},{"start":{"row":31,"column":21},"end":{"row":31,"column":42},"action":"insert","lines":["petme123456@gmail.com"]}],[{"start":{"row":37,"column":30},"end":{"row":37,"column":44},"action":"remove","lines":["your@gmail.com"],"id":3},{"start":{"row":37,"column":30},"end":{"row":37,"column":51},"action":"insert","lines":["petme123456@gmail.com"]}],[{"start":{"row":38,"column":17},"end":{"row":38,"column":31},"action":"remove","lines":["your@gmail.com"],"id":4},{"start":{"row":38,"column":17},"end":{"row":38,"column":38},"action":"insert","lines":["petme123456@gmail.com"]}],[{"start":{"row":52,"column":27},"end":{"row":52,"column":38},"action":"remove","lines":["campgrounds"],"id":5},{"start":{"row":52,"column":27},"end":{"row":52,"column":28},"action":"insert","lines":["d"]},{"start":{"row":52,"column":28},"end":{"row":52,"column":29},"action":"insert","lines":["o"]},{"start":{"row":52,"column":29},"end":{"row":52,"column":30},"action":"insert","lines":["g"]},{"start":{"row":52,"column":30},"end":{"row":52,"column":31},"action":"insert","lines":["s"]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":18,"column":17},"end":{"row":18,"column":17},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1522594087170,"hash":"56d827c3f8ea5d6287a9b13cdfd30bbd3a8c71dc"}